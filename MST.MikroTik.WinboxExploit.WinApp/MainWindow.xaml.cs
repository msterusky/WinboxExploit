using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;

namespace MST.MikroTik.WinboxExploit.WinApp
{
    /// <summary>
    /// Interaction logic for MainWindow.xaml
    /// </summary>
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }

        private void runButton_Click(object sender, RoutedEventArgs e)
        {
            runButton.IsEnabled = false;
            runButton.Visibility = Visibility.Visible;

            try
            {
                log.Clear();
                var result = WinboxExploitManager.Run(ip.Text, int.Parse(port.Text));

                var text = string.Join(
                    Environment.NewLine,
                    result.Select(r => $"{r.Name} - {r.Password}")
                );
                log.AppendText(text);
            }
            catch (Exception ex)
            {
                log.AppendText(ex.ToString());
            }
            finally
            {
                runButton.IsEnabled = true;
            }
        }

        private void port_OnPreviewTextInput(object sender, TextCompositionEventArgs e)
        {
            var s = sender as TextBox;
            var text = s.Text.Insert(s.SelectionStart, e.Text);

            int p;
            e.Handled = !int.TryParse(text, out p);
        }
    }
}